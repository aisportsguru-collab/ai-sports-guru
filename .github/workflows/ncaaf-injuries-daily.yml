name: NCAAF Daily Injuries Sync

on:
  schedule:
    - cron: '0 14 * * *'   # 14:00 UTC daily (~7am PT)
  workflow_dispatch: {}

jobs:
  injuries:
    runs-on: ubuntu-latest
    timeout-minutes: 20
    steps:
      - uses: actions/checkout@v4

      - uses: actions/setup-python@v5
        with:
          python-version: '3.11'

      - name: Install Python deps
        run: |
          python -m pip install --upgrade pip
          pip install requests

      - name: Install psql client
        run: |
          sudo apt-get update
          sudo apt-get install -y postgresql-client

      - name: Show repo tree (debug)
        run: |
          pwd
          ls -la
          ls -la scripts/data-sync || true

      - name: Set env
        run: |
          echo "SUPABASE_DB_URL=${{ secrets.SUPABASE_DB_URL }}" >> $GITHUB_ENV
          echo "CFBD_API_KEY=${{ secrets.CFBD_API_KEY }}" >> $GITHUB_ENV
          echo "INJURY_SEASONS=$(date +%Y)" >> $GITHUB_ENV

      - name: Run injuries sync
        env:
          SUPABASE_DB_URL: ${{ env.SUPABASE_DB_URL }}
          CFBD_API_KEY: ${{ env.CFBD_API_KEY }}
          INJURY_SEASONS: ${{ env.INJURY_SEASONS }}
        run: bash scripts/data-sync/injuries_sync_ncaaf.sh
